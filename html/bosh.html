<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>PaaS Monitoring</title>
		<link rel="stylesheet" type="text/css" media="screen" href="resources/css/layout.css" />
		<script type="text/javascript" src="resources/js/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="resources/js/jquery-ui.js"></script>
		<script type="text/javascript" src="resources/js/jquery.cookie.js"></script>
		<script type="text/javascript" src="resources/js/common.js"></script>
	</head>
	<body>

		<!-- Wrap -->
		<div id="wrap">
			
			<!-- Header -->
			<header>
				<h1><a href="index.html"><img src="resources/img/h1_logo.png" alt="PaaS Monitoring" ></a></h1>
				<nav>
					<ul>
						<li><a href="#" class="alarmView"><span>0</span><img src="resources/img/btn__header_alarm.png" alt="alarm" ></a></li>
						<li><a href="#" class="timeSetting"><img src="resources/img/btn__header_cal.png" alt="calendar" ></a></li>
						<li><a href="javascript:location.reload();"><img src="resources/img/btn__header_reload.png" alt="reload" ></a></li>
						<li class="outBtn">
							<a href="#"><img src="resources/img/btn__header_user.png" alt="user" ></a>
							<span class="logout"><a href="#">Logout</a></span>
						</li>
					</ul>
				<nav>
				<div class="timePop">
					<h4>Time Range</h4>
					<div class="timer">
						<div>
							<input type="radio" name="timeRange" id="tr01" value="15">
							<label for="tr01">최근 15분</label>
							<input type="radio" name="timeRange" id="tr02" value="30">
							<label for="tr02">최근 30분</label>
							<input type="radio" name="timeRange" id="tr03" value="60">
							<label for="tr03">최근 1시간</label>
							<input type="radio" name="timeRange" id="tr04" value="180">
							<label for="tr04">최근 3시간</label>
							<input type="radio" name="timeRange" id="tr05" value="360">
							<label for="tr05">최근 6시간</label>
							<input type="radio" name="timeRange" id="tr06" value="720">
							<label for="tr06">최근 12시간</label>
							<input type="radio" name="timeRange" id="tr07" value="1440">
							<label for="tr07">최근 1일</label>
							<input type="radio" name="timeRange" id="tr08" value="10080">
							<label for="tr08">최근 이번주</label>
							<input type="radio" name="timeRange" id="tr09" value="40320">
							<label for="tr09">최근 이번달</label>
						</div>
						<div style="display:none;">
							<input type="radio" name="timeRange" id="tr10">
							<label for="tr10">수동설정</label>
							<input type="text" id="from" name="from">
							<input type="text" id="to" name="to">
						</div>
					</div>
					<h4>Refreshing Time</h4>
					<div class="refresh">
						<div class="select_wrap">
							<select id="timeSelect">
								<option value="0">OFF</option>
								<option value="1">1m</option>
								<option value="5">5m</option>
								<option value="15">15m</option>
								<option value="30">30m</option>
								<option value="60">1h</option>
								<option value="120">2h</option>
								<option value="1440">1d</option>
							</select>
							<label for="timeSelect">OFF</label>
						</div>
					</div>
					<div class="btnWrap center">
						<button class="close">Close</button>
						<button class="save">Save Changes</button>
					</div>
					<a href="#" class="close">close</a>
				</div>
			</header>
			<!-- // Header -->

			<!-- Container -->
			<div id="container">
				
				<!-- Navigation -->
				<nav>
					<ul>
						<li class="on"><a href="bosh.html">Bosh</a></li>
						<li><a href="paas.html">PaaS-TA</a></li>
						<li><a href="cont.html">Container</a></li>
						<li>
							<a href="alarm_policy.html"><span>Alarm</span></a>
							<ul>
								<li><a href="alarm_policy.html">Policy</a></li>
								<li><a href="alarm_status.html">Status</a></li>
								<li><a href="alarm_statis.html">Statistics</a></li>
							</ul>
						</li>
					</ul>
				</nav>
				<!-- // Navigation -->

				<!-- Contents -->
				<section id="contents">
					
					<!-- Location -->
					<div class="location">
						<ul>
							<li><a href="#">PaaS Monitoring</a></li>
							<li><a href="#">Bosh</a></li>
						</ul>
					</div>
					<!-- // Location -->

					<article class="table style01">
						<h4>Bosh Summary</h4>
						<table class="boshSummary">
							<caption>Bosh Summary List</caption>
							<colgroup>
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
							</colgroup>
							<thead>
								<tr>
									<th>Name</th>
									<th>Address</th>
									<th>State</th>
									<th>Core</th>
									<th>CPU<br>Used(%)</th>
									<th>Total<br>Memory(MB)</th>
									<th>Memory<br>Used(%)</th>
									<th>Total<br>Disk(MB)</th>
									<th>Disk<br>Status</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<div class="paging" style="display:none;">
							<a href="#">&lt;</a>
							<span>
								<a href="#" class="on">1</a>
								<a href="#">2</a>
								<a href="#">3</a>
								<a href="#">4</a>
								<a href="#">5</a>
								<a href="#">6</a>
								<a href="#">7</a>
								<a href="#">8</a>
								<a href="#">9</a>
								<a href="#">10</a>
							</span>
							<a href="#">&gt;</a>
						</div>
					</article>
					
					<article class="table style01">
						<h4>Top Process <strong class="boshTopTitle">[monitor-bosh]</strong></h4>
						<table class="boshTop">
							<caption></caption>
							<colgroup>
								<col width="">
								<col width="">
								<col width="">
								<col width="">
								<col width="">
							</colgroup>
							<thead>
								<tr>
									<th>Index</th>
									<th>Time</th>
									<th>PID</th>
									<th>Process</th>
									<th>Memory(MB)</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</article>
				</section>
				<!-- // Contents -->

			</div>
			<!-- // Container -->

		</div>
		<!-- // Wrap -->

		<script type="text/javascript">
			$(function(){

				var boshID = '';
				var boshSummaryURL = pass.url + 'paas/bosh/summary';
				var boshTopProcessURL = pass.url + 'paas/bosh/topprocess/';

				// bosh Summary Data Load
				var boshSummaryData = pass.ajaxLoad(boshSummaryURL);
				var boshTopData = '';

				console.log(boshSummaryData.data);

				var boshSummary = $('.boshSummary tbody'); // bosh Summary table ID
				var boshTop = $('.boshTop tbody'); // bosh Summary table ID

				boshSummary.empty(); // bosh Summary Clear

				$.each(boshSummaryData.data, function(n){ // bosh Summary List Add
					/************************ Data Example *************************
					address: "10.20.0.6"
					core: "8"
					cpuErrStat: "running"
					cpuUsage: 0.31
					dataDisk: 142462.5703125
					diskDataErrStat: "healthy"
					diskRootErrStat: "healthy"
					diskStatus: "healthy"
					id: "f2e1c906-34ae-4a13-581d-1d161cc516d6"
					memErrStat: "running"
					memoryUsage: 54.97
					name: "micro-bosh"
					state: "running"
					totalDisk: 2818.65625
					totalMemory: 16046.84765625
					***************************************************************/
					var html = '<tr>';
					html += '	<td><a href="javacsrtip:void(0);" class="topView">'+this.name+'</a></td>';
					html += '	<td>'+this.address+' <a href="bosh_chart.html" class="chartView"><img src="resources/img/table_icon_view.png" alt="chart view"></a></td>';
					html += '	<td class="'+this.state+'">'+this.state+'</td>';
					html += '	<td>'+this.core+'</td>';
					html += '	<td>'+this.cpuUsage+'</td>';
					html += '	<td>'+pass.numberComma(0, this.totalMemory)+'</td>';
					html += '	<td>'+pass.numberComma(2, this.memoryUsage)+'</td>';
					html += '	<td>'+pass.numberComma(0, this.totalDisk)+'</td>';
					html += '	<td>'+this.diskStatus+'</td>';
					html += '</tr>';

					boshSummary.append(html).find('tr').last().data({'id':this.id});

					if(n == 0){
						boshID = this.id;

						boshTopFunction(this.name);
					} else if(n > 4){
						boshSummary.append(html).find('tr').last().hide();
					};
				});

				function boshTopFunction(name){
					var boshTopData = pass.ajaxLoad(boshTopProcessURL+boshID+'/memory');
					console.log(boshTopData.data);

					$('.boshTopTitle').text('[ '+name+' ]');
				
					boshTop.empty();
					$.each(boshTopData.data, function(n){ // bosh Top List Add
						/************************ Data Example *************************
						index: "1"
						memory: 449.203125
						pid: "27457"
						process: "java"
						time: "2018-11-13T05:41:02"
						***************************************************************/
						var html = '<tr>';
						html += '	<td>'+this.index+'</td>';
						html += '	<td>'+this.time+'</td>';
						html += '	<td>'+this.pid+'</td>';
						html += '	<td>'+this.process+'</td>';
						html += '	<td>'+pass.numberComma(0, this.memory)+'</td>';
						html += '</tr>';
						
						boshTop.append(html);
					});
				};


				/***************************** Event *********************************/
				boshSummary.find('.topView').on('click', function(){
					boshID = $(this).parents('tr').data('id');

					boshTopFunction($(this).text());
				});

				boshSummary.find('.chartView').on('click', function(){
					$.cookie('result', $(this).parents('tr').data('id'));
					$.cookie('name', $(this).parents('tr').find('.topView').text());
				});
			})
		</script>

	</body>
</html>