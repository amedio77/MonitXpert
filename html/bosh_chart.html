<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>PaaS Monitoring</title>
		<link rel="stylesheet" type="text/css" media="screen" href="resources/css/layout.css" />
		<script type="text/javascript" src="resources/js/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" src="resources/js/jquery-ui.js"></script>
		<script type="text/javascript" src="resources/js/jquery.cookie.js"></script>
		<script type="text/javascript" src="resources/js/common.js"></script>
	</head>
	<body>

		<!-- Wrap -->
		<div id="wrap">
			
			<!-- Header -->
			<header>
				<h1><a href="index.html"><img src="resources/img/h1_logo.png" alt="PaaS Monitoring" ></a></h1>
				<nav>
					<ul>
						<li><a href="#" class="alarmView"><span>0</span><img src="resources/img/btn__header_alarm.png" alt="alarm" ></a></li>
						<li><a href="#" class="timeSetting"><img src="resources/img/btn__header_cal.png" alt="calendar" ></a></li>
						<li><a href="javascript:location.reload();"><img src="resources/img/btn__header_reload.png" alt="reload" ></a></li>
						<li class="outBtn">
							<a href="#"><img src="resources/img/btn__header_user.png" alt="user" ></a>
							<span class="logout"><a href="#">Logout</a></span>
						</li>
					</ul>
				<nav>
				<div class="timePop">
					<h4>Time Range</h4>
					<div class="timer">
						<div>
							<input type="radio" name="timeRange" id="tr01" value="15">
							<label for="tr01">최근 15분</label>
							<input type="radio" name="timeRange" id="tr02" value="30">
							<label for="tr02">최근 30분</label>
							<input type="radio" name="timeRange" id="tr03" value="60">
							<label for="tr03">최근 1시간</label>
							<input type="radio" name="timeRange" id="tr04" value="180">
							<label for="tr04">최근 3시간</label>
							<input type="radio" name="timeRange" id="tr05" value="360">
							<label for="tr05">최근 6시간</label>
							<input type="radio" name="timeRange" id="tr06" value="720">
							<label for="tr06">최근 12시간</label>
							<input type="radio" name="timeRange" id="tr07" value="1440">
							<label for="tr07">최근 1일</label>
							<input type="radio" name="timeRange" id="tr08" value="10080">
							<label for="tr08">최근 이번주</label>
							<input type="radio" name="timeRange" id="tr09" value="40320">
							<label for="tr09">최근 이번달</label>
						</div>
						<div style="display:none;">
							<input type="radio" name="timeRange" id="tr10">
							<label for="tr10">수동설정</label>
							<input type="text" id="from" name="from">
							<input type="text" id="to" name="to">
						</div>
					</div>
					<h4>Refreshing Time</h4>
					<div class="refresh">
						<div class="select_wrap">
							<select id="timeSelect">
								<option value="0">OFF</option>
								<option value="1">1m</option>
								<option value="5">5m</option>
								<option value="15">15m</option>
								<option value="30">30m</option>
								<option value="60">1h</option>
								<option value="120">2h</option>
								<option value="1440">1d</option>
							</select>
							<label for="timeSelect">OFF</label>
						</div>
					</div>
					<div class="btnWrap center">
						<button class="close">Close</button>
						<button class="save">Save Changes</button>
					</div>
					<a href="#" class="close">close</a>
				</div>
			</header>
			<!-- // Header -->

			<!-- Container -->
			<div id="container">
				
				<!-- Navigation -->
				<nav>
					<ul>
						<li class="on"><a href="bosh.html">Bosh</a></li>
						<li><a href="paas.html">PaaS-TA</a></li>
						<li><a href="cont.html">Container</a></li>
						<li>
							<a href="alarm_policy.html"><span>Alarm</span></a>
							<ul>
								<li><a href="alarm_policy.html">Policy</a></li>
								<li><a href="alarm_status.html">Status</a></li>
								<li><a href="alarm_statis.html">Statistics</a></li>
							</ul>
						</li>
					</ul>
				</nav>
				<!-- // Navigation -->

				<!-- Contents -->
				<section id="contents">
					
					<!-- Location -->
					<div class="location">
						<ul>
							<li><a href="#">PaaS Monitoring</a></li>
							<li><a href="#">Bosh</a></li>
							<li><a href="#">Chart</a></li>
						</ul>
					</div>
					<!-- // Location -->

                    <article class="boshChart">
                        <div class="tab style01">
                            <ul>
                                <li class="on"><a href="#">Chart</a></li>
                                <li><a href="bosh_logs.html">Logs</a></li>
                            </ul>
                            <div>
                                <a href="bosh.html" class="overview">Overview</a>
                            </div>
                        </div>
                        <ul class="list">
                            <li>
								<h5>CPU Usage</h5>
								<div id="chart1" class="chartWrap"></div>
							</li>
                            <li>
								<h5>CPU Load Average</h5>
								<div id="chart2" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Memory Usage</h5>
								<div id="chart3" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Disk Usage</h5>
								<div id="chart4" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Disk IO</h5>
								<div id="chart5" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Network IO Byte</h5>
								<div id="chart6" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Network IO Packets</h5>
								<div id="chart7" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Network IO Drop</h5>
								<div id="chart8" class="chartWrap"></div>
							</li>
                            <li>
								<h5>Network IO Error</h5>
								<div id="chart9" class="chartWrap"></div>
							</li>
                        </ul>
                    </article>
				</section>
				<!-- // Contents -->

			</div>
			<!-- // Container -->

		</div>
		<!-- // Wrap -->

		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script type="text/javascript">
			$(function(){
				if($.cookie('name') != null){
					$('.location ul').append('<li><a href="#">' + $.cookie('name') + '</a></li>');
				};

				var loadParam = '?defaultTimeRange='+ $.cookie('defaultTimeRange') +'m&groupBy='+ $.cookie('groupBy') +'m';

				var boshUsageURL = [];
				boshUsageURL[0] = pass.url + 'paas/bosh/cpu/'+ $.cookie('result') +'/usages'+loadParam; // CPU Usage 정보
				boshUsageURL[1] = pass.url + 'paas/bosh/cpu/'+ $.cookie('result') +'/loads'+loadParam; // CPU Load 정보
				boshUsageURL[2] = pass.url + 'paas/bosh/memory/'+ $.cookie('result') +'/usages'+loadParam; // Memory Usage 정보
				boshUsageURL[3] = pass.url + 'paas/bosh/disk/'+ $.cookie('result') +'/usages'+loadParam; // Disk Usage 정보
				boshUsageURL[4] = pass.url + 'paas/bosh/disk/'+ $.cookie('result') +'/ios'+loadParam; // Disk IO 정보
				boshUsageURL[5] = pass.url + 'paas/bosh/network/'+ $.cookie('result') +'/bytes'+loadParam; // Network IO Byte 정보
				boshUsageURL[6] = pass.url + 'paas/bosh/network/'+ $.cookie('result') +'/packets'+loadParam; // Network IO Packets 정보
				boshUsageURL[7] = pass.url + 'paas/bosh/network/'+ $.cookie('result') +'/drops'+loadParam; // Network IO Drop 정보
				boshUsageURL[8] = pass.url + 'paas/bosh/network/'+ $.cookie('result') +'/errors'+loadParam; // Network IO Error 정보

				var chartData = pass.ajaxLoad(boshUsageURL[0]);
				
				google.charts.load('current', {'packages':['corechart']});

				$.each(boshUsageURL, function(n){
					google.charts.setOnLoadCallback(drawChart);

					function drawChart() {
						var jsonData = '';
						$.ajax({
							url: boshUsageURL[n],
							dataType: 'json',
							async: false,
							beforeSend : function(xhr){
								xhr.setRequestHeader('X-XSRF-TOKEN', sessionStorage.getItem('token'));
							},
							success:function(data){
								jsonData = data;
							},
							error:function(data){
								console.log(data.responseJSON.HttpStatus+' ERROR!\n '+data.responseJSON.message);
							}
						});

						var dataBuild = [];
						var dataTitle, dataTitle2;
						$.each(jsonData[0].metric, function(x){
							var time = this.time.toFixed(0);
							var usage = this.usage.toFixed(2);

							dataBuild.push([pass.unixTime(Number(time)),Number(usage)]);

							if(x == 0){
								dataTitle = pass.unixTime(Number(time));
								dataTitle2 = pass.unixTime((Number(time) + (60 * 15)));
							};
						});
							
						var data = new google.visualization.DataTable();
						data.addColumn('string', 'time');
						data.addColumn('number', 'usage');
						data.addRows(dataBuild);

						var options = {
							legend : 'none',
							series: {
								0: {
									color: pass.chartColor[n],
									lineWidth: 1,
								},
							},
							chartArea : {
								left:'15%',
								top:'10%',
								width:'70%',
								height:'70%'
							},
							hAxis : {
								title:dataTitle + pass.space() + dataTitle2,
								width:'100%',
								textPosition: 'none',
								gridlines:{color: '#e7e7e7', slantedText: true},
							},
							vAxis : {
								gridlines:{color: '#e7e7e7', count: -1, viewWindowMode: 'pretty', slantedText: true},
							},
							curveType : 'function'
						};

						var chart = new google.visualization.LineChart(document.getElementById('chart'+(n+1)));
						chart.draw(data, options);
					};
				});
			});
		</script>

	</body>
</html>